<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Formview -->
        <record id="provision_form_view_inherit" model="ir.ui.view">
            <field name="name">Provision form view</field>
            <field name="model">provision</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <form>
                    <header>
                        
                        <button name="action_register" string="Register" class="oe_highlight" type="object"  attrs="{'invisible': [('payment_state', '!=', 'draft')]}"/>
                        <button name="action_draft_budget" string="Draft" class="oe_highlight"
                            type="object"
                            attrs="{'invisible':[('payment_state', 'in', ('draft','cancel'))]}"/>

                     <!--    <button name="action_validate_budget" string="Validate budget" class="oe_highlight" type="object" attrs="{'invisible':[('payment_state', '!=', 'registered')]}"/>
 -->
                        <button name="action_cancel_budget" string="Cancel" class="oe_highlight" type="object"  attrs="{'invisible':[('payment_state', 'in', ('paid','cancel'))]}"/>

                   <!--      <button name="action_reschedule" string="Reschedule" class="oe_highlight" type="object"  attrs="{'invisible': [('payment_state', '!=', 'payment_not_applied')]}"/>
 -->
                        <field name="payment_state" widget="statusbar" statusbar_visible="draft,registered,provision,rejected,cancel"/>
                    </header>
                     <sheet>
                        <field name="company_id" invisible="1"/>
                        <field name="is_payment_request" invisible="1"/>
                        <field name="state" invisible="1"/>
                        <field name="commercial_partner_id" invisible="1"/>
                        <field name="is_from_reschedule_payment" invisible="1"/>
                        <field name="is_show_beneficiary_key" invisible="1"/>
                        <field name="is_show_student_account" invisible="1"/>
                        <field name="is_show_commitment_date" invisible="1"/>
                        <field name="is_show_turn_type" invisible="1"/>  
                        <div class="oe_title">
                            <label for="number" class="oe_edit_only"/>
                            <h1>
                                <field name="number"  readonly="1"/>
                            </h1>
                        </div>                          
                        <group>
                            <group>
                                <field name="partner_id" required="1" string="Beneficiary of the payment" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="baneficiary_key" readonly="1"/>
                                <field name="company_id" invisible="1"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="rfc" readonly="1"/>
                                <field name="operation_name" invisible="1"/>
                                <field name="student_account" attrs="{'invisible':[('operation_name','not in',('Scholarship holders','Becarios'))],'required':[('operation_name','in',('Scholarship holders','Becarios'))],'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="transfer_key" attrs="{'invisible':[('operation_name','!=','Becarios')],'required':[('operation_name','=','Becarios')],'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="category_key" attrs="{'invisible':[('operation_name','not in',('Per diem','Travel expenses','Viáticos'))],'required':[('operation_name','in',('Per diem','Travel expenses','Viáticos'))],'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="workstation_id"  attrs="{'invisible': [('operation_name', 'not in',('Viaticum','Travel expenses','Viáticos'))],'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="administrative_forms" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="no_of_document" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="vault_folio" invisible="1"/>
                                <field name="currency_id" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                <field name="journal_id" readonly="1"/>
                                <field name="payment_bank_id" attrs="{'required':[('payment_state','in',('draft','registered'))],'readonly':[('payment_state', 'not in', ('registered','draft','for_payment_procedure'))]}"/>

                                <field name="payment_bank_account_id"  string="Payment receipt bank account" attrs="{'required':[('payment_state','in',('draft','registered'))],'readonly':[('payment_state', 'not in', ('registered','draft','for_payment_procedure'))]}"/>

                                <field name="payment_issuing_bank_id" string="Payment issuing Bank" attrs="{'readonly':[('payment_state', 'not in', ('draft''registered'))]}"/>
                                <field name="payment_issuing_bank_acc_id" attrs="{'readonly':[('payment_state', 'not in', ('draft''registered'))]}"/>
                                <field name="administrative_secretary_id" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="holder_of_dependency_id" string="Holder of the Unit" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="invoice_uuid" invisible="1"/>
                                <field name="invoice_series" invisible="1"/>
                                <field name="folio_invoice" invisible="1"/>
                                <field name="excercise" invisible="1"/>
                                <field name="invoice_vault_folio" invisible="1"/>
                                <field name="line" invisible="1"/>
                            </group>
                            <group>
                                <field name="req_registration_date" required="1" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                
                                <field name="project_number_id" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}" context="{'from_conacyt':1}" domain="[('is_papiit_project','=',True)]"/>
                                <!-- <field name="responsible_id" attrs="{'invisible': [('operation_type_id', 'not in',('REIMBURSEMENT TO THIRD PARTIES','PLANE TICKETS','PAYMENT TO SUPPLIER'))]}"/> -->
                                <field name="responsible_id" attrs="{'invisible':[('operation_name','not in',('Creación de cuentas por pagar','Creation of accounts payable','Boletos de ​ avión','Air tickets',
                                    'Becarios','Interns','Reembolso a terceros','Reimbursement to third parties',
                                    'Trabajos de campo​','Field work','Reembolso a ​ responsables del proyecto','Refund to responsible for the project',
                                    '​ Gastos de intercambio','Exchange expenses','Prácticas escolares','School practices','Viáticos','Travel expenses',
                                    '​ SOLICITUD DE PAGO EN M.E. (PROVEEDORES)','REQUEST FOR PAYMENT IN ME(SUPPLIERS)','PAGO A SUPERIORES ​ Y CONTRATISTAS','PAYMENT TO SUPPLIERS AND CONTRACTORS'
                                    ))],'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                    
                                <field name="project_code" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="agreement_number" readonly="1"/>
                                <field name="stage" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}" invisible="1"/>
                                <field name="dependancy_id" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="sub_dependancy_id" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="folio_dependency" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="folio" readonly="1"/>
                                <field name="operation_type_id" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="date_receipt" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="date_approval_request" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="sheets" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                
                                <field name="l10n_mx_edi_payment_method_id" attrs="{'readonly':[('payment_state', 'not in', ('draft','registered','for_payment_procedure'))]}"/>

                                <field name="document_type" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="upa_key" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="upa_document_type" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="batch_folio" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/> 
                                <field name="is_papiit_project" invisible="1"/>                              
                                <field name="leaves" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}" invisible="1"/>
                                
                                <field name="exchange_rate" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="foreign_currency_amount" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="previous" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                <field name="reason_rejection_req" attrs="{'invisible': [('payment_state', '!=','rejected')]}" readonly="1"/>
                                <field name="reason_rejection" attrs="{'invisible': [('payment_state', '!=','payment_not_applied')]}" readonly="1"/>
                                <field name="reason_cancellation" attrs="{'invisible':[('payment_state', '!=', 'cancel')],'readonly': [('payment_state', '!=', 'draft')]}"/>
                                <field name="agreement_type_id" attrs="{'readonly':[('payment_state', 'not in', ('draft'))]}"/>
                                
                            </group>
                        </group>
                        <label for="reason_rejection_req" attrs="{'invisible': [('payment_state', 'not in', ('rejected'))]}"/>
                        <field name="reason_rejection" readonly="1" attrs="{'invisible': [('payment_state', 'not in', ('rejected'))]}"/>
                        <field name="reason_cancellation" readonly="1" attrs="{'invisible': [('payment_state', 'not in', ('cancel'))]}"/>
                        <notebook>

                            <page string='Inovice Lines' name='invoice_tab'>
                                <field name="provision_line_ids"
                                widget="section_and_note_one2many">
                                    <tree editable="bottom" string="Provision Line">
                                        <field name="product_id"/>
                                        <field name="account_id"/>
                                        <field name="program_code"/>
                                        <field name="turn_type"/>
                                        <field name="type_of_bussiness_line"/>
                                        <field name="egress_key_id"/>
                                        <field name="invoice_uuid"/>
                                        <field name="invoice_series"/>
                                        <field name="folio_invoice"/>
                                        <field name="vault_folio"/>
                                        <field name="quantity"/>
                                        <field name="price_unit"/>
                                        <field name="other_amounts"/>
                                        <field name="discount"/>
                                        <field name="tax_ids" widget="many2many_tags"/>
                                        <field name="subtotal"/>
                                        <field name="provision_id" invisible="1"/>
                                         
                                    </tree>
                            </field>
                                <group class="oe_subtotal_footer">
                                    <field name="amount_untaxed"/>
                                    <field name="amount_tax" colspan="2"/>
                                    <field name="amount_total" class="oe_subtotal_footer_separator"/>
                                </group>
                            
                            </page>
                            <page string="Journal Items" name="accounts">
                                <field name="line_ids" readonly="1"/>
                            </page>

                            <page name="more_info" string="More Information">
                                <group>
                                    <group name="reason" string="Reason">
                                        <field name="is_show_reason_for_expendiure" invisible="1"/>
                                        <field name="reason_for_expendiure" attrs="{'invisible':[('operation_name','not in',('Creación de cuentas por pagar','Creation of accounts payable',
                                        'Trabajos de campo','Field work','Prácticas escolares​','School internships','Gastos de intercambio','Exchange expenses','Viáticos','Travel expenses'
                                        ))],'readonly': [('payment_state', '!=', 'draft')]}"/> <!-- 'invisible':[('is_show_reason_for_expendiure','=',False)], -->
                                        <field name="is_show_destination" invisible="1"/>
                                        <field name="destination" attrs="{'invisible':[('operation_name','not in',('Prácticas escolares','School practices'
                                        'Trabajos de campo','Field work','Viáticos','Travel expenses'
                                        ))],'readonly': [('payment_state', '!=', 'draft')]}"/> <!-- 'invisible':[('is_show_destination','=',False)], -->
                                        <field name="is_show_origin" invisible="1"/>
                                        <field name="origin_payment" attrs="{'invisible':[('operation_name','not in',('​ Gastos de intercambio','Exchange expenses'))],'readonly': [('payment_state', '!=', 'draft')]}"/> <!-- 'invisible':[('is_show_origin','=',False)], -->
                                        <field name="rf_person" attrs="{'readonly': [('payment_state', '!=', 'draft')]}" invisible="1"/>
                                    </group>

                                    <group name="responsible" string="Responsible">
                                        <field name="is_show_resposible_group" invisible="1"/>
                                        <field name="responsible_expend_id" attrs="{'invisible':[('operation_name','not in',('Creación de cuentas por pagar','Creation of accounts payable','Trabajos de campo','Field work','Prácticas escolares','School internships','Gastos de intercambio','Exchange expenses'))],'readonly': [('payment_state', '!=', 'draft')]}"/> <!-- 'invisible':[('is_show_resposible_group','=',False)], -->
                                        <field name="responsible_rfc" readonly="1" attrs="{'invisible':[('operation_name','not in',('Creación de cuentas por pagar','Creation of accounts payable','Trabajos de campo','Field work','Prácticas escolares','School internships','Gastos de intercambio','Exchange expenses'))]}"/>
                                        <field name="responsible_category_key" readonly="1" attrs="{'invisible':[('operation_name','not in',('Creación de cuentas por pagar','Creation of accounts payable','Trabajos de campo','Field work','Prácticas escolares','School internships','Gastos de intercambio','Exchange expenses'))]}"/>
                                        <field name="manager_job_id" readonly="1" attrs="{'invisible':[('operation_name','not in',('Creación de cuentas por pagar','Creation of accounts payable','Trabajos de campo','Field work','Prácticas escolares','School internships','Gastos de intercambio','Exchange expenses'))]}"/>
                                    </group>
                                </group>
                                <group>                                
                                    <group name="zone" string="Zone Responsible">
                                        <field name="is_zone_res" invisible="1"/>
                                        <field name="zone" attrs="{'invisible':[('operation_name','not in',('Viáticos','Viatical'))],'readonly': [('payment_state', '!=', 'draft')]}"/> <!-- 'invisible':[('is_zone_res','=',False)],- -->
                                        <field name="rate" attrs="{'invisible':[('operation_name','not in',('Viáticos','Viatical'))],'readonly': [('payment_state', '!=', 'draft')]}"/>
                                        <field name="days" attrs="{'invisible':[('operation_name','not in',('Viáticos','Viatical'))],'readonly': [('payment_state', '!=', 'draft')]}"/>
                                    </group>
                                    <group></group>
                                </group>
                            </page>


                        </notebook>

                     </sheet>
                </form>
            </field>
        </record>


        <!-- Treeview -->
        <record id="provision_tree_view_inherit" model="ir.ui.view">
            <field name="name">Provision tree view</field>
            <field name="model">provision</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="partner_id"/>
                    <field name="payment_state"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="supplier_provision_action" model="ir.actions.act_window">
            <field name="name">provision</field>
            <field name="res_model">provision</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'hide_validate_button':True,'show_for_supplier_payment':True,'default_is_payment_request': 1}</field>
            <field name="domain">[('is_payment_request', '=', True)]</field>     
        </record>

       <menuitem id="supplier_provision_menu" name="Provisions"
          action="supplier_provision_action"
          parent="jt_payroll_payment.menu_payroll_admin_process_unit" sequence="5"/>

     </data>
</odoo>
