<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Formview -->
        <record id="payment_req_form_view_inherit" model="ir.ui.view">
            <field name="name">Payment Request form view</field>
            <field name="model">account.move</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <form>
                    <header>
                        
                        <button name="action_register" string="Register" class="oe_highlight" type="object"  attrs="{'invisible': [('payment_state', '!=', 'draft')]}"/>
                        <button name="action_draft_budget" string="Draft" class="oe_highlight"
                            type="object"
                            attrs="{'invisible':[('payment_state', 'in', ('draft','paid','cancel'))]}"/>
                        <button name="action_validate_budget" invisible="context.get('hide_validate_button',False)" string="Validate budget" class="oe_highlight"
                                    type="object" attrs="{'invisible':[('payment_state', '!=', 'registered')]}"/>
                        <button name="action_cancel_budget" string="Cancel" class="oe_highlight" type="object"  attrs="{'invisible':[('payment_state', 'in', ('paid','cancel'))]}"/>
                        <field name="payment_state" widget="statusbar" statusbar_visible="draft,registered,approved_payment,for_payment_procedure,paid,payment_not_applied,rejected,cancel"/>
                    </header>
                     <sheet>
                         <div>
                            <!-- Invoice draft header -->
                            <span class="o_form_label"><field name="type" attrs="{'invisible': ['|', ('type', '=', 'entry'), ('state', '=', 'draft')]}" readonly="1" nolabel="1"/></span>
                            <h1>
                                <span attrs="{'invisible': ['|', '|', ('type', '!=', 'out_invoice'), ('state', '!=', 'draft'), ('name', '!=', '/')]}">Draft Invoice</span>
                                <span attrs="{'invisible': ['|', '|', ('type', '!=', 'out_refund'), ('state', '!=', 'draft'), ('name', '!=', '/')]}">Draft Credit Note</span>
                                <span attrs="{'invisible': ['|', '|', ('type', '!=', 'in_invoice'), ('state', '!=', 'draft'), ('name', '!=', '/')]}">Draft Bill</span>
                                <span attrs="{'invisible': ['|', '|', ('type', '!=', 'in_refund'), ('state', '!=', 'draft'), ('name', '!=', '/')]}">Draft Refund</span>
                                <span attrs="{'invisible': ['|', '|', ('type', '!=', 'out_receipt'), ('state', '!=', 'draft'), ('name', '!=', '/')]}">Draft Sales Receipt</span>
                                <span attrs="{'invisible': ['|', '|', ('type', '!=', 'in_receipt'), ('state', '!=', 'draft'), ('name', '!=', '/')]}">Draft Purchase Receipt</span>
                            </h1>
                             <!-- Number -->
                            <h1 class="mt0">
                                <field name="name" readonly="True" attrs="{'invisible':[('name', '=', '/')]}"/>
                            </h1>
                        </div>
                        <field name="company_id" invisible="1"/>
                        <field name="is_payment_request" invisible="1"/>
                        <field name="type" invisible="1"/>
                        <field name="state" invisible="1"/>
                        <field name="invoice_filter_type_domain" invisible="1"/>
                        <field name="company_currency_id" invisible="1"/>
                        <field name="commercial_partner_id" invisible="1"/>
                        <field name="bank_partner_id" invisible="1"/>
                        <field name="is_project_payment" invisible="1"/>
                        <group>
                            <group>
                                <field name="parnter_id"/>
                                <field name="baneficiary_key"/>
                                <field name="rfc"/>
                                <field name="student_account"/>
                                <field name="transfer_key"/>
                                <field name="category_key"/>
                                <field name="workstation_id"/>
                                <field name="administrative_forms"/>
                                <field name="no_of_document"/>
                                <field name="vault_folio"/>
                                <field name="payment_bank_id"/>
                                <field name="payment_bank_account_id"/>
                                <field name="payment_issuing_bank_id"/>
                                <field name="payment_issuing_bank_acc_id"/>
                                <field name="responsible_id"/>
                                <field name="administrative_secretary_id"/>
                                <field name="holder_of_unit_id" />
                                <field name="invoice_uuid"/>
                                <field name="invoice_series"/>
                                <field name="folio_invoice"/>
                                <field name="user_registering_id"/>
                                <field name="diary"/>
                                <field name="excercise"/>
                                <field name="project_key"/>
                                <field name="invoice_vault_folio"/>
                                <field name="line"/>
                                <field name="previous"/>

                            </group>
                            <group>
                                <field name="project_number_id"/>
                                <field name="agreement_number"/>
                                <field name="stage"/>
                                <field name="folio_dependency"/>
                                <field name="folio_against_reciept"/>
                                <field name="operation_type_id"/>
                                <field name="date_receipt"/>
                                <field name="date_approval_request"/>
                                <field name="sheets"/>
                                <field name="dependence"/>
                                <field name="subdependence"/>
                                <field name="l10n_mx_edi_payment_method_id"/>
                                <field name="document_type"/>
                                <field name="upa_key"/>
                                <field name="upa_document_type"/>
                                <field name="batch_folio"/>                               
                                <field name="leaves"/>
                                <field name="project_code"/>
                                <field name="exchange_rate"/>
                                <field name="foreign_currency_amount"/>
                                
                                <field name="reason_rejection_req"/>
                                <field name="reason_rejection"/>
                                <field name="reason_cancellation"/>
                                
                            </group>
                        </group>
                        <label for="reason_rejection_req" attrs="{'invisible': [('payment_state', 'not in', ('rejected'))]}"/>
                        <field name="reason_rejection" readonly="1" attrs="{'invisible': [('payment_state', 'not in', ('rejected'))]}"/>
                        <field name="reason_cancellation" readonly="1" attrs="{'invisible': [('payment_state', 'not in', ('cancel'))]}"/>

                        <notebook>
                            <page id="invoice_tab"
                                  string="Invoice Lines"
                                  attrs="{'invisible': [('type', '=', 'entry')]}">
                                <field name="invoice_line_ids"
                                       widget="section_and_note_one2many"
                                       mode="tree,kanban"
                                       attrs="{'readonly': [('payment_state', '!=', 'draft')]}">
                                    <tree editable="bottom" string="Journal Items" default_order="sequence, date desc, move_name desc, id">
                                        <control>
                                            <create name="add_line_control" string="Add a line"/>
                                            <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                            <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                        </control>

                                        <!-- Displayed fields -->
                                        
                                        <field name="concept"/>
                                        <field name="egress_key_id"/>
                                        <field name="bill" />
                                        <field name="programatic_code_id"/>
                                        <field name="type_of_bussiness_line"/>
                                        <field name="vat"/>
                                        <field name="retIVA"/>
                                        <field name="turn_type"/>
                                        <field name="price_unit" string="Price"/>
                                        <field name="other_amounts"/>
        
                                        <field name="price_subtotal"
                                               string="Subtotal"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>

                                        <!-- Others fields -->
                                        <field name="partner_id" invisible="1"/>
                                        <field name="amount_currency" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="debit" invisible="1"/>
                                        <field name="credit" invisible="1"/>
                                        <field name="date" invisible="1"/>
                                        <field name="date_maturity" invisible="1"/>

                                        <field name="tax_line_id" invisible="1"/>
                                        <field name="tax_repartition_line_id" invisible="1"/>
                                        <field name="tag_ids" invisible="1"/>
                                        <field name="tax_base_amount" invisible="1"/>
                                        <field name="tax_exigible" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="company_currency_id" invisible="1"/>
                                        <field name="recompute_tax_line" invisible="1" force_save="1"/>
                                        <field name="display_type" force_save="1" invisible="1"/>
                                        <field name="is_rounding_line" invisible="1"/>
                                        <field name="exclude_from_invoice_tab" invisible="1"/>
                                        <field name="account_internal_type" invisible="1"/>
                                        <field name="always_set_currency_id" invisible="1"/>
                                    </tree>
                                </field>
                                 <!-- Totals (only invoices / receipts) -->
                                <group class="oe_subtotal_footer"
                                    attrs="{'invisible': [('type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}">
                                    <field name="amount_untaxed"/>
                                    <field name="amount_by_group" widget="tax-group-custom-field" nolabel="1" colspan="2"/>
                                    <field name="amount_total" class="oe_subtotal_footer_separator"/>
                                </group>
                            </page>
                            <page name="more_info" string="More Information">
                                <group>
                                    <group name="zone" string="Zone correspondents">
                                        <field name="zone" />
                                        <field name="rate"/>
                                        <field name="days"/>
                                    </group>
                                    <group name="reason" string="Reason">
                                        <field name="reason_for_expendiure" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                        <field name="rf_person" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                        <field name="destination" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                        <field name="origin_payment" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                    </group>
                                </group>
                                <group name="responsible" string="Responsible">
                                    <field name="responsible_id" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                    <field name="responsible_category_key" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                    <field name="responsible_rfc" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                    <field name="responsible_job_position" attrs="{'readonly': [('payment_state', '!=', 'draft')]}"/>
                                    </group>


                            </page>
                        </notebook>
                     </sheet>
                </form>
            </field>
        </record>



        <!-- Treeview -->
        <record id="payment_req_tree_view_inherit" model="ir.ui.view">
            <field name="name">Payment Request tree view</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="partner_id"/>
                    <field name="invoice_date"/>
                    <field name="payment_state"/>
                    <field name="type" invisible="1"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- Action -->
        <record id="project_project_supplier_payment_action" model="ir.actions.act_window">
            <field name="name">Request for Payment</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'show_for_supplier_payment':True,'default_type': 'in_invoice', 'default_is_payment_request': 1,
                'from_move': 1}</field>
            <field name="domain">[('type', '=', 'in_invoice'), ('is_payment_request', '=', True)]</field>
        </record>


          <record id="payment_req_form_action_suppliers_inherit" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="payment_req_form_view_inherit"/>
            <field name="act_window_id" ref="project_project_supplier_payment_action"/>
        </record>

        <record id="payment_req_tree_action_suppliers_inherit" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="payment_req_tree_view_inherit"/>
            <field name="act_window_id" ref="project_project_supplier_payment_action"/>
        </record>


        <!-- Main menu -->
        <menuitem id="supplier_payment_request_main_menu" name="UPA PAPIIT"
                sequence="6" parent="project.menu_main_pm" />

        <menuitem id="supplier_payment_request_menu" name="Payment Request"
                  action="project_project_supplier_payment_action"
                  parent="jt_projects.supplier_payment_request_main_menu" sequence="1"/>
    </data>

</odoo>
 